# ============================================================================
# 資料模型定義檔 (Data Models)
# ============================================================================
# 說明：定義系統中使用的資料結構，包含配置、請求、回應等模型
# 用途：提供型別安全的資料驗證與轉換機制
# ============================================================================

# 標準函式庫匯入
from typing import Optional  # 用於定義可選型別 (可為 None)

# 第三方函式庫匯入
from pydantic import BaseModel, Field  # Pydantic 資料驗證框架
from pydantic_settings import BaseSettings  # 用於環境變數配置管理


# ============================================================================
# 1. 應用程式配置模型 (Application Configuration)
# ============================================================================
class AppConfig(BaseSettings):
    """
    應用程式配置類別
    
    功能：
    - 從環境變數或 .env 檔案讀取配置
    - 管理 Google API 金鑰與模型設定
    - 使用 Imagen 3 模型進行專業資訊圖表生成
    """
    
    # Google API 金鑰 (必填欄位，從環境變數讀取)
    google_api_key: str = Field(
        ...,  # 使用 ... 表示此欄位為必填
        description="Google API Key"  # 欄位說明
    )
    
    # 圖像生成模型名稱 (預設使用 Nano Banana Pro)
    img_model: str = "gemini-3-pro-image-preview"
    
    class Config:
        """Pydantic 配置類別"""
        env_file = ".env"  # 指定環境變數檔案路徑


# ============================================================================
# 2. 圖像生成請求模型 (Image Generation Request)
# ============================================================================
class ImageGenRequest(BaseModel):
    """
    圖像生成請求資料模型
    
    功能：
    - 封裝圖像生成所需的輸入參數
    - 驗證請求資料的完整性與格式
    """
    
    # 圖像生成的文字提示詞 (必填)
    prompt: str
    
    # 圖像長寬比例 (預設為 16:9，適合簡報使用)
    aspect_ratio: str = "16:9"


# ============================================================================
# 3. 圖像生成結果模型 (Image Generation Result)
# ============================================================================
class ImageGenResult(BaseModel):
    """
    圖像生成結果資料模型
    
    功能：
    - 封裝 AI 圖像生成的回應資料
    - 支援多模態回應 (圖像 + 文字說明)
    - 提供錯誤處理機制
    """
    
    # 操作是否成功的標記
    success: bool
    
    # Base64 編碼的圖像資料 (成功時包含，失敗時為 None)
    image_base64: Optional[str] = None
    
    # AI 生成的文字內容 (如設計理念、思考過程等)
    text_content: Optional[str] = None
    
    # 錯誤訊息 (失敗時包含錯誤描述)
    error: Optional[str] = None


# ============================================================================
# 4. 簡報頁面內容模型 (Slide Content)
# ============================================================================
class SlideContent(BaseModel):
    """
    簡報單頁內容資料模型
    
    功能：
    - 定義簡報每一頁的結構化資料
    - 整合文字內容與背景圖像
    - 支援框架對映 (例如 SCQA 架構)
    """
    
    # 簡報頁面唯一識別碼
    slide_id: str
    
    # 框架章節標記 (用於對映捷運路線結構，如 point_opening, reasons 等)
    framework_section: str
    
    # 簡報頁面標題
    title: str
    
    # 簡報頁面主要文字內容
    body_text: str
    
    # 背景圖像的 Base64 編碼資料 (可選)
    background_image_base64: Optional[str] = None
    
    # 設計理念或 AI 生成說明 (可選，用於記錄圖像生成的思考邏輯)
    rationale: Optional[str] = None


# ============================================================================
# 模型定義完成
# ============================================================================